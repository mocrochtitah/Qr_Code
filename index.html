<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Bartender</title>
<style>
body { font-family: Arial; text-align:center; background:#111; color:#fff; margin:0; padding:20px; }
h1{font-size:2rem;margin-top:10px;}
h2{font-size:1.5rem;}
.hidden{display:none;}
button{
    display:block;
    width:80%;
    max-width:300px;
    margin:10px auto;
    padding:20px;
    font-size:1.3rem;
    border:none;
    border-radius:15px;
    cursor:pointer;
    background:#444;
    color:#fff;
    transition:0.3s;
}
button:hover:not(:disabled){background:#666;} 
button:disabled{background:#222;color:#666;cursor:not-allowed;}
input {
    display: block;
    width: 80%;
    max-width: 250px;
    padding: 10px;
    margin: 10px auto;
    border-radius: 10px;
    border: none;
    font-size: 1.1rem;
}
#progressBar{margin-top:20px;width:90%;max-width:400px;height:35px;background:#333;border-radius:20px;overflow:hidden;margin-left:auto;margin-right:auto;}
#progress{height:100%;width:0%;background:limegreen;transition:width 0.3s;}
#status{margin-top:20px;font-size:1.3rem;}
#queueList{margin-top:10px;font-size:1rem;}
.drink-info{font-size:1rem;margin-bottom:10px;}
.timer{font-size:1.2rem;margin-top:10px;}
</style>
</head>
<body>
<h1>Smart Bartender üç∏</h1>

<!-- Start scherm -->
<div id="startScreen">
  <button id="userBtn">üçπ Gebruiker</button>
  <button id="adminBtn">üîß Admin</button>
</div>

<!-- Admin login -->
<div id="adminLogin" class="hidden">
  <h2>Admin Login</h2>
  <input type="text" id="username" placeholder="Gebruikersnaam">
  <input type="password" id="password" placeholder="Wachtwoord">
  <button id="loginBtn">Login</button>
  <button id="adminBackBtn">‚¨ÖÔ∏è Terug</button>
  <p id="loginStatus"></p>
</div>

<!-- Admin panel -->
<div id="adminPanel" class="hidden">
  <h2>Admin Panel</h2>
  <button onclick="flushPump(1)">Spoel Pomp 1</button>
  <button onclick="flushPump(2)">Spoel Pomp 2</button>
  <button onclick="flushPump(3)">Spoel Pomp 3</button>
  <button onclick="flushPump(4)">Spoel Pomp 4</button>
  <button onclick="flushPump(5)">Spoel Pomp 5</button>
  <button onclick="flushPump(6)">Spoel Pomp 6</button>
  <button onclick="adminLogout()">‚¨ÖÔ∏è Logout</button>
  <div id="adminStatus"></div>
</div>

<!-- Drank opties -->
<div id="drinkOptions" class="hidden">
  <h2>Kies je drankje:</h2>
  <div class="drink-info" id="drinkInfo"></div>
  <button onclick="confirmDrink(1, 'Rum & Coke', 'ü•É Rum & Cola, klassiek drankje')">ü•É Rum & Coke</button>
  <button onclick="confirmDrink(2, 'Wodka Sprite', 'üç∏ Wodka met Sprite, verfrissend!')">üç∏ Wodka Sprite</button>
  <button onclick="confirmDrink(3, 'Sangria', 'üçπ Sangria, lekker fruitig')">üçπ Sangria</button>
  <button onclick="confirmDrink(4, 'Screwdriver', 'üçä Wodka met sinaasappelsap')">üçä Screwdriver</button>
  <button onclick="confirmDrink(5, 'Rum & Fanta', 'ü•É Rum & Fanta, dubbel genieten!')">ü•É Rum & Fanta</button>
  <button id="stopBtn" class="hidden">‚èπÔ∏è Stop</button>
  <button id="backBtn">‚¨ÖÔ∏è Terug</button>
</div>

<!-- Status + Progress -->
<p id="status"></p>
<div id="progressBar" class="hidden"><div id="progress"></div></div>
<div id="timer" class="timer"></div>
<div id="queueList"></div>

<script>
// Pi IP vast in code
let PI_URL = "http://192.168.141.224:5000";

// Elementen
const startScreen = document.getElementById("startScreen");
const userBtn = document.getElementById("userBtn");
const adminBtn = document.getElementById("adminBtn");
const adminLogin = document.getElementById("adminLogin");
const usernameInput = document.getElementById("username");
const passwordInput = document.getElementById("password");
const loginBtn = document.getElementById("loginBtn");
const loginStatus = document.getElementById("loginStatus");
const adminPanel = document.getElementById("adminPanel");
const adminStatus = document.getElementById("adminStatus");
const adminBackBtn = document.getElementById("adminBackBtn");
const drinkOptions = document.getElementById("drinkOptions");
const backBtn = document.getElementById("backBtn");
const statusText = document.getElementById("status");
const progressBar = document.getElementById("progressBar");
const progress = document.getElementById("progress");
const drinkButtons = drinkOptions.querySelectorAll("button:not(#backBtn):not(#stopBtn)");
const stopBtn = document.getElementById("stopBtn");
const drinkInfo = document.getElementById("drinkInfo");
const timerDisplay = document.getElementById("timer");
const queueList = document.getElementById("queueList");

// Queue
let drinkQueue=[], isPouring=false, currentInterval=null, currentTimeout=null;

// Startscherm
userBtn.addEventListener("click",()=>{startScreen.classList.add("hidden"); drinkOptions.classList.remove("hidden"); updateQueueDisplay();});
adminBtn.addEventListener("click",()=>{startScreen.classList.add("hidden"); adminLogin.classList.remove("hidden");});
adminBackBtn.addEventListener("click",()=>{adminLogin.classList.add("hidden"); startScreen.classList.remove("hidden"); loginStatus.textContent="";});
loginBtn.addEventListener("click",()=>{
    const user=usernameInput.value, pass=passwordInput.value;
    if(user==="admin"&&pass==="admin"){
        adminLogin.classList.add("hidden");
        adminPanel.classList.remove("hidden");
        adminStatus.textContent="";
    } else {
        loginStatus.textContent="‚ùå Ongeldige login!";
    }
});
function adminLogout(){adminPanel.classList.add("hidden"); startScreen.classList.remove("hidden");}

// Queue systeem
function queueDrink(drinkId, drinkName){drinkQueue.push({id:drinkId,name:drinkName}); updateQueueDisplay(); processQueue();}
function updateQueueDisplay(){queueList.textContent = drinkQueue.length===0?"": "Queue: " + drinkQueue.map((d,i)=>`#${i+1} ${d.name}`).join(" ‚Üí ");}

// Drank keuze
function confirmDrink(drinkId,drinkName,info){
    if(isPouring){alert("Er wordt al een drankje geschonken! Wacht tot het klaar is."); return;}
    if(confirm(`Weet je zeker dat je ${drinkName} wilt schenken?`)){
        drinkInfo.textContent=info;
        drinkButtons.forEach(btn=>btn.disabled=true);
        queueDrink(drinkId,drinkName);
    }
}

// Stop knop
stopBtn.addEventListener("click",()=>{
    if(currentInterval) clearInterval(currentInterval);
    if(currentTimeout) clearTimeout(currentTimeout);
    statusText.textContent="Bestelling gestopt ‚ùå"; progress.style.width="0%"; timerDisplay.textContent="";
    isPouring=false; stopBtn.classList.add("hidden"); drinkButtons.forEach(btn=>btn.disabled=false);
    processQueue();
});

// Process queue
function processQueue(){
    if(isPouring || drinkQueue.length===0) return;
    isPouring=true;
    const nextDrink=drinkQueue.shift();
    updateQueueDisplay();
    drinkButtons.forEach(btn=>btn.disabled=true);
    stopBtn.classList.remove("hidden");
    progressBar.classList.remove("hidden"); progress.style.width="0%";
    
    if(PI_URL){
        fetch(`${PI_URL}/pour/${nextDrink.id}`)
        .then(r=>r.json())
        .then(d=>{
            console.log(d);
            statusText.textContent = `Aan het schenken: ${nextDrink.name} ‚úÖ`;
        })
        .catch(err=>{
            console.error(err);
            statusText.textContent = `‚ùå Fout bij schenken ${nextDrink.name}`;
        });
    } else {
        statusText.textContent = `Simulatie: ${nextDrink.name} geserveerd ‚úÖ`;
    }

    let seconds=10;
    if(currentInterval) clearInterval(currentInterval);
    if(currentTimeout) clearTimeout(currentTimeout);
    timerDisplay.textContent=`Klaar in: ${seconds}s`;
    currentInterval=setInterval(()=>{
        seconds--;
        if(seconds>=0){
            timerDisplay.textContent=`Klaar in: ${seconds}s`;
            progress.style.width=`${(10-seconds)*10}%`;
        }
    },1000);
    currentTimeout=setTimeout(()=>{
        clearInterval(currentInterval);
        progress.style.width="100%";
        isPouring=false;
        stopBtn.classList.add("hidden");
        drinkButtons.forEach(btn=>btn.disabled=false);
        processQueue();
    },10000);
}

backBtn.addEventListener('click',()=>{
    drinkOptions.classList.add('hidden'); statusText.textContent=""; progressBar.classList.add('hidden'); progress.style.width="0%"; timerDisplay.textContent=""; startScreen.classList.remove('hidden');
});

// Admin functies
function flushPump(pumpId){
    if(PI_URL){
        fetch(`${PI_URL}/flush/${pumpId}`)
        .then(r=>r.json())
        .then(d=>{
            console.log(d);
            adminStatus.textContent = `‚úÖ Pomp ${pumpId} gespoeld`;
        })
        .catch(err=>{
            console.error(err);
            adminStatus.textContent = `‚ùå Fout bij Pomp ${pumpId}`;
        });
    } else {
        adminStatus.textContent=`Simulatie: Pomp ${pumpId} gespoeld ‚úÖ`;
    }
}
</script>
</body>
</html>
